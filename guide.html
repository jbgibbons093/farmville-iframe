<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Hughberry Farms - Game Guide</title>
  <link href="fonts.css" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    html {
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Nunito', sans-serif;
      background: transparent;
      overflow-x: hidden;
      display: flex;
      justify-content: center;
    }

    .guide-container {
      background: #2a1a08;
      color: #3a2a1a;
      width: 95vw;
      max-width: 950px;
      border-radius: 22px;
      border: 4px solid #D4880B;
      box-shadow: 0 0 30px rgba(212,136,11,0.3), 0 20px 60px rgba(0,0,0,0.5);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .guide-body {
      display: flex;
      flex: 1;
      overflow: hidden;
      max-height: 85vh;
    }

    /* Sidebar Navigation */
    .guide-sidebar {
      width: 190px;
      min-width: 190px;
      background: linear-gradient(180deg, #3a2810 0%, #2a1a08 100%);
      border-right: 2px solid #5a3a1a;
      overflow-y: auto;
      padding: 12px 0;
      flex-shrink: 0;
    }

    .guide-sidebar::-webkit-scrollbar { width: 10px; }
    .guide-sidebar::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 5px; }
    .guide-sidebar::-webkit-scrollbar-thumb { background: #5a3a1a; border-radius: 5px; }

    .sidebar-link {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 14px;
      color: #a89070;
      font-size: 14px;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.15s;
      border-left: 3px solid transparent;
    }

    .sidebar-link:hover {
      background: rgba(255, 215, 0, 0.08);
      color: #c9a86c;
    }

    .sidebar-link.active {
      background: rgba(255, 215, 0, 0.12);
      color: #FFD700;
      border-left-color: #FFD700;
    }

    .sidebar-icon {
      font-size: 17px;
      width: 22px;
      text-align: center;
    }

    .sidebar-label {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Header Bar */
    .header-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 22px;
      background: linear-gradient(145deg, #6a4820 0%, #4a3010 100%);
      border-bottom: 3px solid #D4880B;
    }

    .header-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header-icon {
      font-size: 34px;
    }

    .header-text {
      font-family: 'Luckiest Guy', cursive;
      font-size: 28px;
      color: #FFD700;
      text-shadow: 2px 2px 0 #8B4513;
    }

    .close-hint {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 15px;
      color: #888;
    }

    .close-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 10px 18px;
      background: linear-gradient(145deg, #c0392b, #a93226);
      border: 2px solid #e74c3c;
      border-radius: 10px;
      color: #fff;
      font-family: 'Nunito', sans-serif;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.15s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 4px 0 #8b0000;
    }

    .close-btn:hover {
      background: linear-gradient(145deg, #e74c3c, #c0392b);
      transform: scale(1.08) translateY(-2px);
      box-shadow: 0 6px 0 #8b0000, 0 0 12px rgba(231,76,60,0.4);
    }

    .close-btn:active {
      transform: scale(0.97) translateY(2px);
      box-shadow: 0 1px 0 #8b0000;
    }

    .key-hint {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 28px;
      height: 28px;
      padding: 0 8px;
      background: #333;
      border: 2px solid #555;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 700;
      color: #fff;
      box-shadow: 0 3px 0 #222;
    }

    /* Breadcrumb */
    .breadcrumb {
      padding: 12px 20px;
      font-size: 14px;
      color: #8a7a60;
      border-bottom: 1px solid rgba(139,69,19,0.15);
      background: rgba(139,69,19,0.04);
    }
    .breadcrumb a {
      color: #8B4513;
      text-decoration: none;
      cursor: pointer;
      font-weight: 600;
    }
    .breadcrumb a:hover { text-decoration: underline; }
    .breadcrumb .sep { margin: 0 6px; color: #bbb; }

    /* Main Content */
    .guide-wrapper {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      scroll-behavior: smooth;
      background: linear-gradient(145deg, #f5f0e6 0%, #ebe4d6 100%);
      display: flex;
      flex-direction: column;
    }

    .page-content {
      flex: 1;
    }

    /* Guide Sections */
    .guide-section {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.7) 0%, rgba(245, 240, 230, 0.7) 100%);
      border: 3px solid #c9a86c;
      border-radius: 14px;
      padding: 24px;
      margin-bottom: 20px;
      display: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .guide-section.active-page {
      display: block;
    }

    .guide-section-title {
      font-family: 'Luckiest Guy', cursive;
      font-size: 24px;
      color: #FFD700;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .guide-section-title::after {
      content: '';
      flex: 1;
      height: 2px;
      background: linear-gradient(90deg, #FFD700, transparent);
    }

    .guide-text {
      font-size: 15px;
      line-height: 1.7;
      color: #3a2a1a;
      margin-bottom: 12px;
    }

    .guide-text strong { color: #8B4513; }
    .guide-text em { color: #2874a6; font-style: normal; }

    .guide-list {
      list-style: none;
      padding: 0;
      margin: 10px 0;
    }

    .guide-list li {
      padding: 10px 0 10px 32px;
      position: relative;
      border-bottom: 1px solid rgba(139, 69, 19, 0.2);
      color: #3a2a1a;
      font-size: 15px;
    }

    .guide-list li:last-child { border-bottom: none; }

    .guide-list li::before {
      content: '';
      position: absolute;
      left: 0;
      top: 14px;
      width: 20px;
      height: 20px;
      background: linear-gradient(145deg, #c9a86c, #a0824a);
      border-radius: 5px;
    }

    .guide-list.numbered li::before {
      content: counter(guide-counter);
      counter-increment: guide-counter;
      background: linear-gradient(145deg, #27ae60, #1e8449);
      color: #fff;
      font-size: 11px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .guide-list.numbered { counter-reset: guide-counter; }

    .guide-tip {
      background: rgba(39, 174, 96, 0.15);
      border: 3px solid #27ae60;
      border-radius: 14px;
      padding: 14px 18px;
      margin: 15px 0;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .guide-tip-icon { font-size: 24px; flex-shrink: 0; }
    .guide-tip-text { font-size: 15px; color: #2ecc71; }

    .guide-warning {
      background: rgba(243, 156, 18, 0.15);
      border: 3px solid #f39c12;
      border-radius: 14px;
      padding: 14px 18px;
      margin: 15px 0;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .guide-warning-icon { font-size: 24px; flex-shrink: 0; }
    .guide-warning-text { font-size: 15px; color: #f39c12; }

    .guide-table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      font-size: 15px;
      border-radius: 10px;
      overflow: hidden;
    }

    .guide-table th {
      background: linear-gradient(145deg, #8B4513, #6b3410);
      color: #fff;
      padding: 12px 10px;
      text-align: left;
      font-weight: 700;
      font-size: 15px;
      border: 1px solid #5a4530;
    }

    .guide-table td {
      padding: 10px;
      border: 1px solid #c9a86c;
      color: #3a2a1a;
    }

    .guide-table tr:nth-child(even) { background: rgba(139, 69, 19, 0.08); }
    .guide-table .icon-col { text-align: center; font-size: 22px; width: 44px; }

    .guide-subsection {
      margin: 15px 0;
      padding: 18px;
      background: rgba(139, 69, 19, 0.08);
      border-radius: 14px;
      border-left: 4px solid #8B4513;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .guide-subsection-title {
      font-size: 18px;
      font-weight: 700;
      color: #8B4513;
      margin-bottom: 10px;
    }

    .guide-key {
      display: inline-block;
      background: #3a2a1a;
      color: #fff;
      padding: 4px 10px;
      border-radius: 6px;
      font-family: monospace;
      font-size: 14px;
      margin: 0 2px;
      border: 2px solid #5a4530;
      box-shadow: 0 2px 0 #1a1008;
    }

    /* Cross-reference links */
    .xref {
      color: #2874a6;
      text-decoration: none;
      cursor: pointer;
      font-weight: 700;
      border-bottom: 1px dashed #2874a6;
      transition: all 0.15s;
    }
    .xref:hover {
      color: #1a5276;
      border-bottom-style: solid;
    }

    /* Prev / Next navigation */
    .page-nav {
      display: flex;
      justify-content: space-between;
      align-items: stretch;
      margin-top: 20px;
      gap: 12px;
    }

    .page-nav-btn {
      display: flex;
      flex-direction: column;
      padding: 14px 18px;
      background: linear-gradient(145deg, rgba(255,255,255,0.7), rgba(245,240,230,0.7));
      border: 3px solid #c9a86c;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.15s cubic-bezier(0.34, 1.56, 0.64, 1);
      text-decoration: none;
      min-width: 140px;
      flex: 0 1 45%;
      box-shadow: 0 4px 0 rgba(160,130,74,0.3);
    }

    .page-nav-btn:hover {
      border-color: #FFD700;
      background: rgba(255,215,0,0.08);
      transform: scale(1.04) translateY(-2px);
      box-shadow: 0 6px 0 rgba(160,130,74,0.3), 0 0 12px rgba(255,215,0,0.15);
    }

    .page-nav-btn:active {
      transform: scale(0.97) translateY(2px);
      box-shadow: 0 1px 0 rgba(160,130,74,0.3);
    }

    .page-nav-btn.prev { align-items: flex-start; }
    .page-nav-btn.next { align-items: flex-end; margin-left: auto; }

    .page-nav-dir {
      font-size: 13px;
      font-weight: 700;
      color: #8B4513;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .page-nav-label {
      font-size: 16px;
      font-weight: 700;
      color: #3a2a1a;
      margin-top: 2px;
    }

    .page-nav-spacer {
      flex: 0 1 45%;
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar { width: 10px; }
    ::-webkit-scrollbar-track { background: rgba(139, 69, 19, 0.1); }
    ::-webkit-scrollbar-thumb { background: #c9a86c; border-radius: 5px; }
    ::-webkit-scrollbar-thumb:hover { background: #a0824a; }
  </style>
</head>
<body>
<script>var _uiPopCtx=null;var _uiPopBuf=null;var _uiPopPlayed=false;try{_uiPopCtx=new(window.AudioContext||window.webkitAudioContext)();fetch('ui-pop.mp3').then(function(r){return r.arrayBuffer()}).then(function(b){return _uiPopCtx.decodeAudioData(b)}).then(function(d){_uiPopBuf=d}).catch(function(){})}catch(e){}</script>
  <div class="guide-container">
  <!-- Header Bar -->
  <div class="header-bar">
    <div class="header-title">
      <span class="header-icon">&#x1F4D6;</span>
      <span class="header-text">Game Guide</span>
    </div>
    <div class="close-hint">
      <span>Press <span class="key-hint">ESC</span> Close</span>
      <button class="close-btn" onclick="closeGuide()">
        <span>&#x2715;</span>
        <span>Close</span>
      </button>
    </div>
  </div>

  <!-- Guide Body with Sidebar -->
  <div class="guide-body">
    <!-- Sidebar Navigation -->
    <nav class="guide-sidebar">
      <a class="sidebar-link active" data-target="welcome" onclick="navigateTo('welcome')">
        <span class="sidebar-icon">&#x1F3E1;</span>
        <span class="sidebar-label">Welcome</span>
      </a>
      <a class="sidebar-link" data-target="getting-started" onclick="navigateTo('getting-started')">
        <span class="sidebar-icon">&#x1F331;</span>
        <span class="sidebar-label">Getting Started</span>
      </a>
      <a class="sidebar-link" data-target="crops" onclick="navigateTo('crops')">
        <span class="sidebar-icon">&#x1F33E;</span>
        <span class="sidebar-label">Growing Crops</span>
      </a>
      <a class="sidebar-link" data-target="animals" onclick="navigateTo('animals')">
        <span class="sidebar-icon">&#x1F404;</span>
        <span class="sidebar-label">Raising Animals</span>
      </a>
      <a class="sidebar-link" data-target="equipment" onclick="navigateTo('equipment')">
        <span class="sidebar-icon">&#x2692;&#xFE0F;</span>
        <span class="sidebar-label">Equipment</span>
      </a>
      <a class="sidebar-link" data-target="crafting" onclick="navigateTo('crafting')">
        <span class="sidebar-icon">&#x2692;&#xFE0F;</span>
        <span class="sidebar-label">Crafting</span>
      </a>
      <a class="sidebar-link" data-target="marketplace" onclick="navigateTo('marketplace')">
        <span class="sidebar-icon">&#x1F3EA;</span>
        <span class="sidebar-label">Marketplace</span>
      </a>
      <a class="sidebar-link" data-target="leveling" onclick="navigateTo('leveling')">
        <span class="sidebar-icon">&#x2B50;</span>
        <span class="sidebar-label">XP & Leveling</span>
      </a>
      <a class="sidebar-link" data-target="tips" onclick="navigateTo('tips')">
        <span class="sidebar-icon">&#x1F4DD;</span>
        <span class="sidebar-label">Tips & Strategies</span>
      </a>
      <a class="sidebar-link" data-target="talents" onclick="navigateTo('talents')">
        <span class="sidebar-icon">&#x1F33F;</span>
        <span class="sidebar-label">Talent System</span>
      </a>
      <a class="sidebar-link" data-target="contracts" onclick="navigateTo('contracts')">
        <span class="sidebar-icon">&#x1F4CB;</span>
        <span class="sidebar-label">Contracts</span>
      </a>
      <a class="sidebar-link" data-target="gold-store" onclick="navigateTo('gold-store')">
        <span class="sidebar-icon">&#x1FA99;</span>
        <span class="sidebar-label">Gold Store</span>
      </a>
      <a class="sidebar-link" data-target="rebirth" onclick="navigateTo('rebirth')">
        <span class="sidebar-icon">&#x1F504;</span>
        <span class="sidebar-label">Rebirth</span>
      </a>
      <a class="sidebar-link" data-target="blessings" onclick="navigateTo('blessings')">
        <span class="sidebar-icon">&#x2728;</span>
        <span class="sidebar-label">Blessings</span>
      </a>
      <a class="sidebar-link" data-target="controls" onclick="navigateTo('controls')">
        <span class="sidebar-icon">&#x1F3AE;</span>
        <span class="sidebar-label">Controls</span>
      </a>
      <a class="sidebar-link" data-target="faq" onclick="navigateTo('faq')">
        <span class="sidebar-icon">&#x2753;</span>
        <span class="sidebar-label">FAQ</span>
      </a>
    </nav>

    <!-- Guide Content -->
    <div class="guide-wrapper" id="guideContent">
      <!-- Breadcrumb -->
      <div class="breadcrumb" id="breadcrumb">
        <a onclick="navigateTo('welcome')">Game Guide</a>
        <span class="sep">&#x203A;</span>
        <span id="breadcrumb-current">Welcome</span>
      </div>

      <div class="page-content">

      <!-- Welcome Section -->
      <div class="guide-section active-page" id="welcome">
        <div class="guide-section-title">&#x1F3E1; Welcome to Hughberry Farms!</div>
        <p class="guide-text">
          Welcome, farmer! <strong>Hughberry Farms</strong> is a relaxing farming simulation where you'll
          <a class="xref" onclick="navigateTo('crops')">grow crops</a>,
          <a class="xref" onclick="navigateTo('animals')">raise animals</a>,
          <a class="xref" onclick="navigateTo('crafting')">craft goods</a>, and build your farming empire.
          This guide will teach you everything you need to know to become a master farmer!
        </p>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Quick Links</div>
          <p class="guide-text">
            <a class="xref" onclick="navigateTo('getting-started')">Getting Started</a> &mdash; New to the farm? Start here!<br>
            <a class="xref" onclick="navigateTo('crops')">Growing Crops</a> &mdash; Learn about planting, growing, and harvesting<br>
            <a class="xref" onclick="navigateTo('animals')">Raising Animals</a> &mdash; Cows, chickens, sheep, and more<br>
            <a class="xref" onclick="navigateTo('equipment')">Equipment Upgrades</a> &mdash; Bronze through Platinum tiers<br>
            <a class="xref" onclick="navigateTo('crafting')">Crafting System</a> &mdash; Turn raw materials into valuable goods<br>
            <a class="xref" onclick="navigateTo('marketplace')">Marketplace</a> &mdash; Buy seeds, sell goods, and more<br>
            <a class="xref" onclick="navigateTo('leveling')">XP &amp; Leveling</a> &mdash; Level progression and unlock table<br>
            <a class="xref" onclick="navigateTo('talents')">Talent System</a> &mdash; Spend points in 3 specialization trees<br>
            <a class="xref" onclick="navigateTo('contracts')">Contracts</a> &mdash; Fulfill delivery orders for bonus rewards<br>
            <a class="xref" onclick="navigateTo('gold-store')">Gold Store</a> &mdash; Purchase gold with USDC<br>
            <a class="xref" onclick="navigateTo('rebirth')">Rebirth</a> &mdash; Reset at Level 50 for leaderboard glory<br>
            <a class="xref" onclick="navigateTo('blessings')">Rebirth Blessings</a> &mdash; Permanent meta-progression (Ritual Area, 2nd floor of house)<br>
            <a class="xref" onclick="navigateTo('controls')">Controls</a> &mdash; Keyboard and mouse reference<br>
            <a class="xref" onclick="navigateTo('faq')">FAQ</a> &mdash; Frequently asked questions
          </p>
        </div>

        <div class="guide-tip">
          <span class="guide-tip-icon">&#x1F4A1;</span>
          <span class="guide-tip-text"><strong>Quick Tip:</strong> Press <span class="guide-key">E</span> to open your inventory and manage your farm.
          Press <span class="guide-key">Y</span> to open the <a class="xref" onclick="navigateTo('talents')">Talent Tree</a>.
          Press <span class="guide-key">L</span> to open the <a class="xref" onclick="navigateTo('rebirth')">Rebirth Leaderboard</a>.
          Press <span class="guide-key">V</span> to open the <a class="xref" onclick="navigateTo('gold-store')">Gold Store</a>.
          Press <span class="guide-key">G</span> to toggle this guide on/off!</span>
        </div>
      </div>

      <!-- Getting Started -->
      <div class="guide-section" id="getting-started">
        <div class="guide-section-title">&#x1F331; Getting Started</div>
        <p class="guide-text">
          When you first arrive at Hughberry Farms, you'll start at <strong>Level 0</strong> with some free wheat seeds to get you going!
          Here's what you should do first:
        </p>
        <ol class="guide-list numbered">
          <li><strong>Buy Seeds</strong> - Visit the <a class="xref" onclick="navigateTo('marketplace')">Seed Store</a> in the marketplace to purchase Wheat and Carrot seeds</li>
          <li><strong>Plant Your Crops</strong> - Go to the <em>Crops</em> tab or walk to a plot in the 3D world and plant your seeds (see <a class="xref" onclick="navigateTo('crops')">Growing Crops</a>)</li>
          <li><strong>Buy Equipment</strong> - Visit the <a class="xref" onclick="navigateTo('marketplace')">Blueprint Store</a> &rarr; <em>Harvesting Tools</em> tab to buy a <em>Milk Pail</em> (required to work with cows)</li>
          <li><strong>Start Your Animals</strong> - Go to the <em>Animals</em> tab and click "Start" on a cow to begin milk production (see <a class="xref" onclick="navigateTo('animals')">Raising Animals</a>)</li>
          <li><strong>Wait & Collect</strong> - Crops and animals take time. When ready, harvest crops and collect products!</li>
        </ol>
        <div class="guide-warning">
          <span class="guide-warning-icon">&#x26A0;&#xFE0F;</span>
          <span class="guide-warning-text"><strong>Important:</strong> You need the correct <a class="xref" onclick="navigateTo('equipment')">equipment</a> to work with each animal type.
          Buy equipment from the <a class="xref" onclick="navigateTo('marketplace')">Blueprint Store</a> before trying to start animal production!</span>
        </div>
      </div>

      <!-- Crops Section -->
      <div class="guide-section" id="crops">
        <div class="guide-section-title">&#x1F33E; Growing Crops</div>
        <p class="guide-text">
          Crops are your bread and butter (literally - you can <a class="xref" onclick="navigateTo('crafting')">craft</a> both!). Here's how the crop system works:
        </p>

        <div class="guide-subsection">
          <div class="guide-subsection-title">How to Plant Crops</div>
          <ol class="guide-list numbered">
            <li><strong>Buy seeds</strong> from the <a class="xref" onclick="navigateTo('marketplace')">Seed Store</a> in the marketplace</li>
            <li>Go to the <em>Crops</em> tab in the inventory menu</li>
            <li>Find an empty plot and select which crop to plant</li>
            <li>Click <strong>"Plant"</strong> to plant the seed</li>
            <li>Wait for the timer to complete (shown on each plot)</li>
            <li>When ready, walk through the crop in the 3D world to harvest</li>
          </ol>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Crop Reference Table</div>
          <table class="guide-table">
            <tr>
              <th class="icon-col">Icon</th>
              <th>Crop</th>
              <th>Grow Time</th>
              <th>Seed Cost</th>
              <th>Sell Price</th>
              <th>Unlock Level</th>
            </tr>
            <tr><td class="icon-col">&#x1F33E;</td><td>Wheat</td><td>30 seconds</td><td>2g</td><td>5g</td><td>Level 0</td></tr>
            <tr><td class="icon-col">&#x1F33D;</td><td>Corn</td><td>60 seconds</td><td>3g</td><td>8g</td><td>Level 3</td></tr>
            <tr><td class="icon-col">&#x1F955;</td><td>Carrot</td><td>45 seconds</td><td>5g</td><td>10g</td><td>Level 7</td></tr>
            <tr><td class="icon-col">&#x1F954;</td><td>Potato</td><td>75 seconds</td><td>6g</td><td>12g</td><td>Level 10</td></tr>
            <tr><td class="icon-col">&#x1F345;</td><td>Tomato</td><td>90 seconds</td><td>8g</td><td>15g</td><td>Level 16</td></tr>
            <tr><td class="icon-col">&#x1F383;</td><td>Pumpkin</td><td>120 seconds</td><td>15g</td><td>30g</td><td>Level 23</td></tr>
          </table>
        </div>

        <div class="guide-tip">
          <span class="guide-tip-icon">&#x1F4A1;</span>
          <span class="guide-tip-text"><strong>Pro Tip:</strong> Use the <em>Auto-Replant</em> toggle in the Crops tab!
          When enabled, harvested plots will automatically replant with your chosen priority crop (if you have seeds).
          See <a class="xref" onclick="navigateTo('tips')">Tips &amp; Strategies</a> for more advice.</span>
        </div>
      </div>

      <!-- Animals Section -->
      <div class="guide-section" id="animals">
        <div class="guide-section-title">&#x1F404; Raising Animals</div>
        <p class="guide-text">
          Animals produce valuable goods like milk, eggs, wool, and more. Each animal type requires
          <strong>specific <a class="xref" onclick="navigateTo('equipment')">equipment</a></strong> before you can work with them.
        </p>

        <div class="guide-subsection">
          <div class="guide-subsection-title">How Animal Production Works</div>
          <ol class="guide-list numbered">
            <li><strong>Buy the required <a class="xref" onclick="navigateTo('equipment')">equipment</a></strong> from the <a class="xref" onclick="navigateTo('marketplace')">Blueprint Store</a></li>
            <li>Go to the <em>Animals</em> tab and click <strong>"Start"</strong> on an idle animal</li>
            <li>Wait for the production timer to complete</li>
            <li>When ready, walk through the <em>collection station</em> in the 3D world to collect</li>
            <li>All ready products from that animal type will be collected at once!</li>
          </ol>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Animal & Equipment Reference</div>
          <table class="guide-table">
            <tr>
              <th class="icon-col">Icon</th>
              <th>Animal</th>
              <th>Product</th>
              <th>Timer</th>
              <th>Required Equipment</th>
              <th>Collection Station</th>
            </tr>
            <tr><td class="icon-col">&#x1F404;</td><td>Cow (x6)</td><td>Milk</td><td>30s</td><td>Milk Pail (50g, Lv.1)</td><td>Milk Pail Station</td></tr>
            <tr><td class="icon-col">&#x1F414;</td><td>Chicken (x6)</td><td>Egg</td><td>45s</td><td>Egg Basket (150g, Lv.5)</td><td>Egg Basket</td></tr>
            <tr><td class="icon-col">&#x1F411;</td><td>Sheep (x6)</td><td>Wool</td><td>60s</td><td>Shearing Kit (250g, Lv.12)</td><td>Wool Bin</td></tr>
            <tr><td class="icon-col">&#x1F410;</td><td>Goat (x6)</td><td>Goat Meat</td><td>75s</td><td>Butcher Knife (350g, Lv.17)</td><td>Butcher Block</td></tr>
            <tr><td class="icon-col">&#x1F437;</td><td>Pig (x6)</td><td>Truffle</td><td>120s</td><td>Truffle Spade (450g, Lv.25)</td><td>Truffle Crate</td></tr>
            <tr><td class="icon-col">&#x1F41D;</td><td>Beehive (x6)</td><td>Honey</td><td>90s</td><td>Bee Suit (400g, Lv.20)</td><td>Honey Jar</td></tr>
          </table>
        </div>

        <p class="guide-text">
          You can unlock more animal slots through the <a class="xref" onclick="navigateTo('talents')">Animal Husbandry talent tree</a>.
          <a class="xref" onclick="navigateTo('equipment')">Equipment upgrades</a> provide additional bonuses like bonus products and faster cooldowns.
        </p>

        <div class="guide-warning">
          <span class="guide-warning-icon">&#x26A0;&#xFE0F;</span>
          <span class="guide-warning-text"><strong>Remember:</strong> Animals are unlocked at different levels!
          Cows at Level 2, Chickens at Level 6, Sheep at Level 13, Goats at Level 18, Beehives at Level 21, and Pigs at Level 26.
          Check the <a class="xref" onclick="navigateTo('leveling')">level progression table</a> for all unlocks.</span>
        </div>
      </div>

      <!-- Equipment Upgrades Section -->
      <div class="guide-section" id="equipment">
        <div class="guide-section-title">&#x2692;&#xFE0F; Equipment Upgrades</div>
        <p class="guide-text">
          Each piece of equipment can be upgraded through <strong>4 tiers</strong> at the
          <a class="xref" onclick="navigateTo('marketplace')">Blueprint Store</a>.
          Higher tiers provide powerful bonuses to your <a class="xref" onclick="navigateTo('animals')">animal production</a>!
        </p>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Equipment Tier Bonuses</div>
          <table class="guide-table">
            <tr>
              <th>Tier</th>
              <th>Name</th>
              <th>Effect</th>
            </tr>
            <tr><td style="background: #cd7f32; color: #000; font-weight: 700;">1</td><td>Bronze</td><td>Equipment unlocked &mdash; you can now work with this animal type</td></tr>
            <tr><td style="background: #c0c0c0; color: #000; font-weight: 700;">2</td><td>Silver</td><td><strong>+1 bonus product</strong> per collection</td></tr>
            <tr><td style="background: #ffd700; color: #000; font-weight: 700;">3</td><td>Gold</td><td><strong>-10% cooldown</strong> reduction on animal timers</td></tr>
            <tr><td style="background: #e5e4e2; color: #000; font-weight: 700;">4</td><td>Platinum</td><td><strong>2x XP multiplier</strong> on animal collections</td></tr>
          </table>
        </div>

        <div class="guide-tip">
          <span class="guide-tip-icon">&#x1F4A1;</span>
          <span class="guide-tip-text"><strong>Pro Tip:</strong> Upgrade to Silver early for bonus products!
          Each collection will give you +1 extra item, which adds up quickly with 6 <a class="xref" onclick="navigateTo('animals')">animals</a> producing.
          Combine with <a class="xref" onclick="navigateTo('talents')">Animal Mastery</a> talent for even more bonus products.</span>
        </div>
      </div>

      <!-- Crafting Section -->
      <div class="guide-section" id="crafting">
        <div class="guide-section-title">&#x2692;&#xFE0F; Crafting System</div>
        <p class="guide-text">
          Turn your raw <a class="xref" onclick="navigateTo('crops')">crops</a> and <a class="xref" onclick="navigateTo('animals')">animal products</a>
          into valuable crafted goods! Crafted items sell for much more than raw materials and give bonus XP.
        </p>

        <div class="guide-subsection">
          <div class="guide-subsection-title">How to Craft</div>
          <ol class="guide-list numbered">
            <li><strong>Buy the recipe</strong> from the <a class="xref" onclick="navigateTo('marketplace')">Blueprint Store</a> &rarr; <em>Cooking Recipes</em> tab (each recipe costs gold and has a level requirement)</li>
            <li>Gather the required <strong>ingredients</strong> (crops, animal products, or other crafted items)</li>
            <li>Visit the <strong>Crafting Table</strong> in the crafting area</li>
            <li>Select your recipe and click <strong>"Craft"</strong></li>
            <li>Sell your crafted goods at the <a class="xref" onclick="navigateTo('marketplace')">Sell Goods</a> stall for profit!</li>
          </ol>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Recipe Reference</div>
          <table class="guide-table">
            <tr>
              <th class="icon-col">Icon</th>
              <th>Recipe</th>
              <th>Ingredients</th>
              <th>Recipe Cost</th>
              <th>Sell Price</th>
              <th>XP</th>
            </tr>
            <tr><td class="icon-col">&#x1F35E;</td><td>Flour</td><td>3 Wheat</td><td>100g (Lv.4)</td><td>10g</td><td>+10</td></tr>
            <tr><td class="icon-col">&#x1F9C8;</td><td>Butter</td><td>2 Milk</td><td>150g (Lv.8)</td><td>30g</td><td>+15</td></tr>
            <tr><td class="icon-col">&#x1F9C0;</td><td>Cheese</td><td>2 Milk</td><td>200g (Lv.9)</td><td>45g</td><td>+15</td></tr>
            <tr><td class="icon-col">&#x1F956;</td><td>Bread</td><td>1 Flour, 1 Egg</td><td>250g (Lv.11)</td><td>35g</td><td>+15</td></tr>
            <tr><td class="icon-col">&#x1F9E3;</td><td>Blanket</td><td>3 Wool</td><td>250g (Lv.14)</td><td>60g</td><td>+20</td></tr>
            <tr><td class="icon-col">&#x1F372;</td><td>Stew</td><td>1 Potato, 1 Carrot, 1 Corn</td><td>300g (Lv.15)</td><td>50g</td><td>+25</td></tr>
            <tr><td class="icon-col">&#x1F356;</td><td>Ragout</td><td>1 Goat Meat, 1 Potato, 1 Carrot</td><td>400g (Lv.19)</td><td>75g</td><td>+30</td></tr>
            <tr><td class="icon-col">&#x1F37A;</td><td>Mead</td><td>2 Honey</td><td>450g (Lv.22)</td><td>100g</td><td>+25</td></tr>
            <tr><td class="icon-col">&#x1F967;</td><td>Pie</td><td>1 Flour, 1 Pumpkin, 1 Egg</td><td>400g (Lv.24)</td><td>100g</td><td>+30</td></tr>
            <tr><td class="icon-col">&#x1F969;</td><td>Meat Pie</td><td>1 Goat Meat, 1 Flour, 1 Egg</td><td>500g (Lv.27)</td><td>90g</td><td>+35</td></tr>
            <tr><td class="icon-col">&#x1F370;</td><td>Cake</td><td>1 Flour, 2 Eggs, 1 Butter</td><td>600g (Lv.28)</td><td>150g</td><td>+40</td></tr>
          </table>
        </div>

        <div class="guide-tip">
          <span class="guide-tip-icon">&#x1F4A1;</span>
          <span class="guide-tip-text"><strong>Pro Tip:</strong> Some recipes require <em>other crafted items</em> as ingredients!
          For example, Bread needs Flour, and Cake needs both Flour and Butter. Plan your crafting chain!
          The <a class="xref" onclick="navigateTo('talents')">Artisan</a> talent boosts crafting XP.</span>
        </div>
      </div>

      <!-- Marketplace Section -->
      <div class="guide-section" id="marketplace">
        <div class="guide-section-title">&#x1F3EA; The Marketplace</div>
        <p class="guide-text">
          The marketplace is your hub for buying and selling. Here you'll find several important stalls:
        </p>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Marketplace Locations</div>
          <table class="guide-table">
            <tr>
              <th class="icon-col">Icon</th>
              <th>Location</th>
              <th>Purpose</th>
            </tr>
            <tr><td class="icon-col">&#x1F331;</td><td>Seed Store</td><td>Buy seeds for all <a class="xref" onclick="navigateTo('crops')">crop types</a>. Higher-level crops cost more but sell for more too!</td></tr>
            <tr><td class="icon-col">&#x1FA99;</td><td>Sell Goods</td><td>Sell your crops, animal products, and <a class="xref" onclick="navigateTo('crafting')">crafted items</a> for gold.</td></tr>
            <tr><td class="icon-col">&#x1F4DC;</td><td>Blueprint Store</td><td>Two tabs: <em>Harvesting Tools</em> (<a class="xref" onclick="navigateTo('equipment')">equipment</a> for animals) and <em>Cooking Recipes</em> (<a class="xref" onclick="navigateTo('crafting')">crafting</a> recipes).</td></tr>
            <tr><td class="icon-col">&#x2692;&#xFE0F;</td><td>Crafting Table</td><td>Located in the <em>crafting area</em>. Craft items using your ingredients and purchased recipes.</td></tr>
            <tr><td class="icon-col">&#x1F4CB;</td><td>Contracts Stall</td><td>View and accept <a class="xref" onclick="navigateTo('contracts')">contracts</a> for bonus gold and XP rewards.</td></tr>
          </table>
        </div>
      </div>

      <!-- XP & Leveling Section -->
      <div class="guide-section" id="leveling">
        <div class="guide-section-title">&#x2B50; XP & Leveling Up</div>
        <p class="guide-text">
          Everything you do on the farm earns <strong>XP (Experience Points)</strong>. Earn enough XP and you'll level up,
          unlocking new <a class="xref" onclick="navigateTo('crops')">crops</a>,
          <a class="xref" onclick="navigateTo('animals')">animals</a>,
          <a class="xref" onclick="navigateTo('crafting')">recipes</a>, and
          <a class="xref" onclick="navigateTo('equipment')">equipment</a>!
          Each level also grants 1 <a class="xref" onclick="navigateTo('talents')">Talent Point</a>.
        </p>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Ways to Earn XP</div>
          <table class="guide-table">
            <tr><th>Activity</th><th>XP Earned</th></tr>
            <tr><td><a class="xref" onclick="navigateTo('crops')">Planting crops</a></td><td>+2 to +5 XP (varies by crop)</td></tr>
            <tr><td><a class="xref" onclick="navigateTo('crops')">Harvesting crops</a></td><td>+5 to +15 XP (varies by crop)</td></tr>
            <tr><td><a class="xref" onclick="navigateTo('animals')">Starting animals</a></td><td>+1 to +5 XP (varies by animal)</td></tr>
            <tr><td><a class="xref" onclick="navigateTo('animals')">Collecting animal products</a></td><td>+3 to +10 XP (varies by product)</td></tr>
            <tr><td><a class="xref" onclick="navigateTo('crafting')">Crafting items</a></td><td>+10 to +40 XP (varies by recipe)</td></tr>
          </table>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Level Unlock Progression (Levels 0-31)</div>
          <table class="guide-table">
            <tr><th>Level</th><th>XP to Next</th><th>Unlock</th></tr>
            <tr><td>0</td><td>50</td><td>Wheat Seeds</td></tr>
            <tr><td>1</td><td>75</td><td>Milk Pail</td></tr>
            <tr><td>2</td><td>100</td><td>Cows</td></tr>
            <tr><td>3</td><td>125</td><td>Corn Seeds</td></tr>
            <tr><td>4</td><td>150</td><td>Flour Recipe</td></tr>
            <tr><td>5</td><td>200</td><td>Egg Basket</td></tr>
            <tr><td>6</td><td>250</td><td>Chickens</td></tr>
            <tr><td>7</td><td>300</td><td>Carrot Seeds</td></tr>
            <tr><td>8</td><td>375</td><td>Butter Recipe</td></tr>
            <tr><td>9</td><td>450</td><td>Cheese Recipe</td></tr>
            <tr><td>10</td><td>525</td><td>Potato Seeds</td></tr>
            <tr><td>11</td><td>600</td><td>Bread Recipe</td></tr>
            <tr><td>12</td><td>700</td><td>Shearing Kit</td></tr>
            <tr><td>13</td><td>800</td><td>Sheep</td></tr>
            <tr><td>14</td><td>900</td><td>Blanket Recipe</td></tr>
            <tr><td>15</td><td>1,000</td><td>Stew Recipe</td></tr>
            <tr><td>16</td><td>1,100</td><td>Tomato Seeds</td></tr>
            <tr><td>17</td><td>1,250</td><td>Butcher Knife</td></tr>
            <tr><td>18</td><td>1,400</td><td>Goats</td></tr>
            <tr><td>19</td><td>1,600</td><td>Ragout Recipe</td></tr>
            <tr><td>20</td><td>1,800</td><td>Bee Suit</td></tr>
            <tr><td>21</td><td>2,000</td><td>Beehives</td></tr>
            <tr><td>22</td><td>2,200</td><td>Mead Recipe</td></tr>
            <tr><td>23</td><td>2,500</td><td>Pumpkin Seeds</td></tr>
            <tr><td>24</td><td>2,800</td><td>Pie Recipe</td></tr>
            <tr><td>25</td><td>3,000</td><td>Truffle Spade</td></tr>
            <tr><td>26</td><td>3,300</td><td>Pigs</td></tr>
            <tr><td>27</td><td>3,600</td><td>Meat Pie Recipe</td></tr>
            <tr><td>28</td><td>4,000</td><td>Cake Recipe</td></tr>
            <tr><td>29</td><td>4,500</td><td>Gold Bonus +500g</td></tr>
            <tr><td>30</td><td>5,000</td><td>XP Bonus +200</td></tr>
            <tr><td>31</td><td>5,500</td><td>Hughberry Legend</td></tr>
            <tr><td>32-50</td><td>6,000-15,000</td><td>Prestige levels (reach 50 to <a class="xref" onclick="navigateTo('rebirth')">Rebirth</a>)</td></tr>
          </table>
        </div>
      </div>

      <!-- Tips & Strategies Section -->
      <div class="guide-section" id="tips">
        <div class="guide-section-title">&#x1F4DD; Tips & Strategies</div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Early Game (Levels 0-7)</div>
          <ul class="guide-list">
            <li><strong>Focus on <a class="xref" onclick="navigateTo('crops')">Wheat</a></strong> - It's cheap, grows fast (30s), and you'll need lots for <a class="xref" onclick="navigateTo('crafting')">Flour</a></li>
            <li><strong>Buy the <a class="xref" onclick="navigateTo('equipment')">Milk Pail</a> first</strong> - It's only 50g and lets you work with all 6 <a class="xref" onclick="navigateTo('animals')">cows</a> at Level 2</li>
            <li><strong>Learn Flour at Level 4</strong> - 3 Wheat makes 1 Flour (10g sell, 10 XP) - great early income</li>
            <li><strong>Get the <a class="xref" onclick="navigateTo('equipment')">Egg Basket</a> at Level 5</strong> - Chickens unlock at Level 6 and produce quickly</li>
            <li><strong>Use Auto-Replant</strong> - Set it to Wheat and let your farm run automatically</li>
          </ul>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Mid Game (Levels 8-18)</div>
          <ul class="guide-list">
            <li><strong>Diversify your <a class="xref" onclick="navigateTo('crops')">crops</a></strong> - Corn (Lv.3), Carrots (Lv.7), and Potatoes (Lv.10) unlock <a class="xref" onclick="navigateTo('crafting')">Stew</a> at Level 15</li>
            <li><strong><a class="xref" onclick="navigateTo('crafting')">Butter and Cheese</a></strong> - Both use milk you're already collecting from <a class="xref" onclick="navigateTo('animals')">cows</a></li>
            <li><strong>Bread is efficient</strong> - Flour + Egg = 35g sell, available at Level 11</li>
            <li><strong>Sheep open up at Level 13</strong> - Wool makes <a class="xref" onclick="navigateTo('crafting')">Blankets</a> (60g sell) at Level 14</li>
            <li><strong>Goats at Level 18</strong> - Meat enables <a class="xref" onclick="navigateTo('crafting')">Ragout</a> (75g sell) at Level 19</li>
          </ul>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Late Game (Levels 19-50)</div>
          <ul class="guide-list">
            <li><strong><a class="xref" onclick="navigateTo('animals')">Beehives</a> (Lv.21) are valuable</strong> - 6 hives producing honey for <a class="xref" onclick="navigateTo('crafting')">Mead</a> (100g sell)</li>
            <li><strong><a class="xref" onclick="navigateTo('crops')">Pumpkins</a> (Lv.23) are king</strong> - 15g cost, 30g sell = 100% profit, plus <a class="xref" onclick="navigateTo('crafting')">Pies</a> (100g)</li>
            <li><strong><a class="xref" onclick="navigateTo('animals')">Pigs</a> (Lv.26) find truffles</strong> - 50g per truffle, the most valuable animal product</li>
            <li><strong><a class="xref" onclick="navigateTo('crafting')">Cake</a> is the ultimate craft</strong> - Flour + Butter + 2 Eggs = 150g sell at Level 28</li>
            <li><strong>Invest in <a class="xref" onclick="navigateTo('talents')">talents</a></strong> - Maximize XP gains with General tree, or specialize in crops/animals</li>
            <li><strong>Run <a class="xref" onclick="navigateTo('contracts')">contracts</a></strong> - Great way to earn bonus gold and XP at higher tiers</li>
            <li><strong><a class="xref" onclick="navigateTo('rebirth')">Rebirth</a> at Level 50</strong> - Reset and compete on the global leaderboard!</li>
          </ul>
        </div>
      </div>

      <!-- Talent System -->
      <div class="guide-section" id="talents">
        <div class="guide-section-title">&#x1F33F; Talent System</div>
        <p class="guide-text">
          As you <a class="xref" onclick="navigateTo('leveling')">level up</a>, you earn <strong>Talent Points</strong> that can be invested in
          three specialization trees. The talent tree displays as a visual node graph with
          connecting lines showing prerequisites. Press <span class="guide-key">Y</span> to open the Talent Tree.
        </p>

        <div class="guide-subsection">
          <div class="guide-subsection-title">How Talents Work</div>
          <ol class="guide-list numbered">
            <li><strong>Earn points</strong> by <a class="xref" onclick="navigateTo('leveling')">leveling up</a> &mdash; you get 1 talent point per level</li>
            <li>Open the <strong>Talent Tree</strong> by pressing <span class="guide-key">Y</span></li>
            <li>Choose one of <strong>three trees</strong>: Farming, Animal Husbandry, or General</li>
            <li>Click on any <strong>glowing green node</strong> to invest a point</li>
            <li>Some talents require <strong>specific prerequisites</strong> (shown by connecting lines)</li>
            <li>Higher tiers unlock after investing enough points in that tree</li>
          </ol>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Prerequisites</div>
          <p class="guide-text">
            Many talents require you to max or partially fill a prerequisite talent first.
            <strong>Gray/locked nodes</strong> show talents you can't invest in yet.
            <strong>Green glowing nodes</strong> show talents available to invest.
            <strong>Gold nodes</strong> show maxed talents.
            Hover over any node to see its prerequisites and current status.
          </p>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Tier Gating</div>
          <p class="guide-text">
            Each tree has 3 tiers. <strong>Tier 1</strong> is always available.
            <strong>Tier 2</strong> unlocks after investing 5 points in that tree.
            <strong>Tier 3</strong> unlocks after investing 10 points in that tree.
            You earn 50 total points but need 99 to max everything &mdash; you must specialize!
          </p>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Respec System</div>
          <p class="guide-text">
            Made a mistake? You can <strong>Respec</strong> to reset all your talent points!
            Click the <strong>Respec</strong> button in the talent tree header. The gold cost scales with your level:
          </p>
          <table class="guide-table">
            <tr><th>Level</th><th>Respec Cost</th></tr>
            <tr><td>0-9</td><td>200g</td></tr>
            <tr><td>10-19</td><td>500g</td></tr>
            <tr><td>20-29</td><td>1,000g</td></tr>
            <tr><td>30-39</td><td>2,000g</td></tr>
            <tr><td>40-50</td><td>3,000g</td></tr>
          </table>
          <p class="guide-text">
            After respec, you receive talent points equal to your current level (since you earn 1 point per level).
          </p>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Farming Tree (32 points to max)</div>
          <p class="guide-text">Unlock more <a class="xref" onclick="navigateTo('crops')">crop plots</a>, speed up growth, and boost harvest yields.</p>
          <table class="guide-table">
            <tr><th>Tier</th><th>Talent</th><th>Ranks</th><th>Prerequisite</th><th>Effect per Rank</th></tr>
            <tr><td>1</td><td>Plot Row 2</td><td>6</td><td>&mdash;</td><td>+1 plot (7&ndash;12)</td></tr>
            <tr><td>1</td><td>Green Thumb</td><td>3</td><td>&mdash;</td><td>-10% crop grow time</td></tr>
            <tr><td>1</td><td>Eager Planter</td><td>3</td><td>&mdash;</td><td>+2 planting XP</td></tr>
            <tr><td>2</td><td>Plot Row 3</td><td>6</td><td>Plot Row 2 (6)</td><td>+1 plot (13&ndash;18)</td></tr>
            <tr><td>2</td><td>Bountiful Harvest</td><td>2</td><td>Green Thumb (3)</td><td>+1 bonus crop per harvest</td></tr>
            <tr><td>2</td><td>Rapid Growth</td><td>3</td><td>Eager Planter (2)</td><td>-10% crop grow time</td></tr>
            <tr><td>3</td><td>Plot Row 4</td><td>6</td><td>Plot Row 3 (6)</td><td>+1 plot (19&ndash;24)</td></tr>
            <tr><td>3</td><td>Crop Mastery</td><td>3</td><td>Bountiful Harvest (2)</td><td>+3 XP to all crop activities</td></tr>
          </table>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Animal Husbandry Tree (38 points to max)</div>
          <p class="guide-text">Unlock more <a class="xref" onclick="navigateTo('animals')">animal</a> slots, reduce cooldowns, and boost product yields.</p>
          <table class="guide-table">
            <tr><th>Tier</th><th>Talent</th><th>Ranks</th><th>Prerequisite</th><th>Effect per Rank</th></tr>
            <tr><td>1</td><td>Cow Herd</td><td>5</td><td>&mdash;</td><td>+1 active cow</td></tr>
            <tr><td>1</td><td>Chicken Flock</td><td>5</td><td>&mdash;</td><td>+1 active chicken</td></tr>
            <tr><td>1</td><td>Quick Hands</td><td>3</td><td>&mdash;</td><td>-10% animal cooldown</td></tr>
            <tr><td>2</td><td>Sheep Pen</td><td>5</td><td>Cow Herd (3)</td><td>+1 active sheep</td></tr>
            <tr><td>2</td><td>Goat Yard</td><td>5</td><td>Chicken Flock (3)</td><td>+1 active goat</td></tr>
            <tr><td>2</td><td>Apiary Expansion</td><td>5</td><td>&mdash;</td><td>+1 active beehive</td></tr>
            <tr><td>2</td><td>Husbandry Knowledge</td><td>3</td><td>Quick Hands (2)</td><td>+2 XP per animal collection</td></tr>
            <tr><td>3</td><td>Pig Sty</td><td>5</td><td>Sheep Pen (3) OR Goat Yard (3)</td><td>+1 active pig</td></tr>
            <tr><td>3</td><td>Animal Mastery</td><td>2</td><td>Husbandry Knowledge (3)</td><td>+1 bonus product per collection</td></tr>
          </table>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">General Tree (29 points to max)</div>
          <p class="guide-text">Boost XP gains across all activities, unlock <a class="xref" onclick="navigateTo('contracts')">contract slots</a>, and earn bonus talent points.</p>
          <table class="guide-table">
            <tr><th>Tier</th><th>Talent</th><th>Ranks</th><th>Prerequisite</th><th>Effect per Rank</th></tr>
            <tr><td>1</td><td>Keen Learner</td><td>3</td><td>&mdash;</td><td>+1 XP to all activities</td></tr>
            <tr><td>1</td><td>Farm Hand</td><td>3</td><td>&mdash;</td><td>+2 XP to planting &amp; harvesting</td></tr>
            <tr><td>1</td><td>Stockman</td><td>3</td><td>&mdash;</td><td>+2 XP to animal starts &amp; collections</td></tr>
            <tr><td>1</td><td>Contractor I</td><td>3</td><td>&mdash;</td><td>+1 <a class="xref" onclick="navigateTo('contracts')">contract slot</a> (slots 2-4)</td></tr>
            <tr><td>2</td><td>Artisan</td><td>3</td><td>Keen Learner (2)</td><td>+3 XP to all <a class="xref" onclick="navigateTo('crafting')">crafting</a></td></tr>
            <tr><td>2</td><td>Seasoned Worker</td><td>3</td><td>Farm Hand (2) OR Stockman (2)</td><td>+2 XP to all activities</td></tr>
            <tr><td>2</td><td>Bonus Talent Point I</td><td>1</td><td>&mdash;</td><td>Gain 1 extra talent point</td></tr>
            <tr><td>2</td><td>Contractor II</td><td>3</td><td>Contractor I (3)</td><td>+1 <a class="xref" onclick="navigateTo('contracts')">contract slot</a> (slots 5-7)</td></tr>
            <tr><td>3</td><td>Prodigy</td><td>3</td><td>Seasoned Worker (3)</td><td>+3 XP to all activities</td></tr>
            <tr><td>3</td><td>Bonus Talent Point II</td><td>1</td><td>Bonus Point I (1)</td><td>Gain 1 extra talent point</td></tr>
            <tr><td>3</td><td>Contractor III</td><td>3</td><td>Contractor II (3)</td><td>+1 <a class="xref" onclick="navigateTo('contracts')">contract slot</a> (slots 8-10)</td></tr>
          </table>
        </div>

        <div class="guide-tip">
          <span class="guide-tip-icon">&#x1F4A1;</span>
          <span class="guide-tip-text"><strong>Tip:</strong> The General tree's <em>Bonus Talent Point</em> talents
          effectively give you a free point &mdash; invest in those early for maximum total points.
          Green Thumb + Rapid Growth stack for up to -60% <a class="xref" onclick="navigateTo('crops')">crop</a> grow time! You can <strong>Respec</strong> at any time to try different builds.</span>
        </div>
      </div>

      <!-- Contracts Board -->
      <div class="guide-section" id="contracts">
        <div class="guide-section-title">&#x1F4CB; Contracts Board</div>
        <p class="guide-text">
          The <strong>Contracts Board</strong> offers delivery orders that reward you with bonus gold and XP.
          Visit the <strong>Contracts stall</strong> in the <a class="xref" onclick="navigateTo('marketplace')">marketplace</a> to view available contracts.
        </p>

        <div class="guide-subsection">
          <div class="guide-subsection-title">How Contracts Work</div>
          <ol class="guide-list numbered">
            <li>Each unlocked slot shows a <strong>pre-assigned contract</strong> &mdash; review the items needed and rewards offered</li>
            <li>Click <strong>"Accept"</strong> to start the <strong>5-minute timer</strong> to fulfill the order</li>
            <li>Gather the required items and click <strong>"Fill Order"</strong> before time runs out</li>
            <li>Contracts are always <strong>very profitable</strong> &mdash; rewards are <strong>2-4x</strong> the value of items requested</li>
            <li>After completing a contract, a <strong>2-minute cooldown</strong> starts before the slot refreshes</li>
            <li>Don't like a contract? Wait for the <strong>2-minute refresh</strong> and each slot gets a new offer</li>
            <li>Unlock more contract slots (up to 10) with <a class="xref" onclick="navigateTo('talents')">Contractor talents</a> in the General tree</li>
          </ol>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Contract Slots</div>
          <table class="guide-table">
            <tr><th>Slots</th><th>How to Unlock</th></tr>
            <tr><td>Slot 1</td><td>Free (always available)</td></tr>
            <tr><td>Slots 2-4</td><td><a class="xref" onclick="navigateTo('talents')">Contractor I</a> talent (General Tier 1)</td></tr>
            <tr><td>Slots 5-7</td><td><a class="xref" onclick="navigateTo('talents')">Contractor II</a> talent (General Tier 2)</td></tr>
            <tr><td>Slots 8-10</td><td><a class="xref" onclick="navigateTo('talents')">Contractor III</a> talent (General Tier 3)</td></tr>
          </table>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Reward Tiers</div>
          <p class="guide-text">Contract rewards scale with your <a class="xref" onclick="navigateTo('leveling')">level</a>:</p>
          <table class="guide-table">
            <tr><th>Tier</th><th>Level</th><th>Reward Multiplier</th></tr>
            <tr><td>Tier 1</td><td>0-9</td><td>1.0x (base)</td></tr>
            <tr><td>Tier 2</td><td>10-19</td><td>1.5x</td></tr>
            <tr><td>Tier 3</td><td>20-29</td><td>2.0x</td></tr>
            <tr><td>Tier 4</td><td>30-39</td><td>2.5x</td></tr>
            <tr><td>Tier 5</td><td>40-50</td><td>3.0x</td></tr>
          </table>
        </div>

        <div class="guide-tip">
          <span class="guide-tip-icon">&#x1F4A1;</span>
          <span class="guide-tip-text"><strong>Pro Tip:</strong> Contracts only request items you can obtain at your current level.
          Higher-tier contracts request more valuable items but give much better rewards!</span>
        </div>
      </div>

      <!-- Gold Store -->
      <div class="guide-section" id="gold-store">
        <div class="guide-section-title">&#x1FA99; Gold Store</div>
        <p class="guide-text">
          Need a boost? Press <span class="guide-key">V</span> to open the <strong>Gold Store</strong> where you can
          purchase gold using <strong>USDC</strong> from your Solana wallet.
        </p>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Available Packages</div>
          <table class="guide-table">
            <tr>
              <th>Package</th>
              <th>Gold</th>
              <th>Price</th>
            </tr>
            <tr><td>Starter Pack</td><td>1,000g</td><td>$2 USDC</td></tr>
            <tr><td>Farmer's Bundle</td><td>5,000g</td><td>$8 USDC</td></tr>
            <tr><td>Tycoon Pack</td><td>15,000g</td><td>$20 USDC</td></tr>
          </table>
        </div>

        <p class="guide-text">
          Gold can be spent on <a class="xref" onclick="navigateTo('crops')">seeds</a>,
          <a class="xref" onclick="navigateTo('equipment')">equipment upgrades</a>,
          <a class="xref" onclick="navigateTo('crafting')">recipes</a>, and
          <a class="xref" onclick="navigateTo('talents')">talent respecs</a>.
        </p>

        <div class="guide-tip">
          <span class="guide-tip-icon">&#x1F4A1;</span>
          <span class="guide-tip-text"><strong>How it works:</strong> Select a package and click Buy. A payment page will open
          where you can connect your Solana wallet (Phantom, Solflare, etc.) and pay with USDC. After paying, return to the Gold Store and click the <strong>Claim Gold</strong> button to add your gold!</span>
        </div>
      </div>

      <!-- Rebirth System -->
      <div class="guide-section" id="rebirth">
        <div class="guide-section-title">&#x1F504; Rebirth System</div>
        <p class="guide-text">
          Once you reach <strong><a class="xref" onclick="navigateTo('leveling')">Level 50</a></strong>, you unlock the ability to <strong>Rebirth</strong>.
          Rebirthing resets all your progress &mdash; gold, XP, level, inventory, <a class="xref" onclick="navigateTo('equipment')">equipment</a>,
          <a class="xref" onclick="navigateTo('crafting')">recipes</a>, and <a class="xref" onclick="navigateTo('talents')">talents</a> &mdash;
          but your <strong>Rebirth Count</strong> is permanently recorded on the global leaderboard!
        </p>

        <div class="guide-subsection">
          <div class="guide-subsection-title">How to Rebirth</div>
          <ol class="guide-list numbered">
            <li>Reach <strong><a class="xref" onclick="navigateTo('leveling')">Level 50</a></strong> through farming, animals, and crafting</li>
            <li>Press <span class="guide-key">L</span> to open the <em>Rebirth Leaderboard</em></li>
            <li>Click the <strong>REBIRTH</strong> button at the bottom of the leaderboard</li>
            <li>Confirm the rebirth in the popup &mdash; this cannot be undone!</li>
            <li>All progress resets to zero and your rebirth count increases by 1</li>
          </ol>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">What Gets Reset</div>
          <ul class="guide-list">
            <li><strong>Gold, XP, and Level</strong> &mdash; back to 0</li>
            <li><strong>All <a class="xref" onclick="navigateTo('crops')">seeds, crops</a>, and <a class="xref" onclick="navigateTo('animals')">animal products</a></strong> &mdash; inventory cleared</li>
            <li><strong>All <a class="xref" onclick="navigateTo('crafting')">crafted items</a></strong> &mdash; flour, bread, cheese, etc.</li>
            <li><strong>All <a class="xref" onclick="navigateTo('equipment')">equipment</a></strong> &mdash; milk pail, shearing kit, etc.</li>
            <li><strong>All <a class="xref" onclick="navigateTo('crafting')">recipes</a></strong> &mdash; must be repurchased</li>
            <li><strong>All <a class="xref" onclick="navigateTo('talents')">talents</a></strong> &mdash; talent points refunded as you level up again</li>
          </ul>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">The Leaderboard</div>
          <p class="guide-text">
            The Rebirth Leaderboard tracks every player's total rebirth count.
            Compete with other farmers to see who can climb the ranks the fastest!
            Your rank, rebirth count, and player name are displayed for all to see.
          </p>
        </div>

        <div class="guide-warning">
          <span class="guide-warning-icon">&#x26A0;&#xFE0F;</span>
          <span class="guide-warning-text"><strong>Warning:</strong> Rebirthing is permanent!
          All your progress will be wiped. Make sure you're ready before confirming.</span>
        </div>

        <div class="guide-tip">
          <span class="guide-tip-icon">&#x1F4A1;</span>
          <span class="guide-tip-text"><strong>Pro Tip:</strong> Each rebirth gets faster as you learn optimal farming routes and invest in
          <a class="xref" onclick="navigateTo('blessings')">Rebirth Blessings</a>! You earn 1 Rebirth Shard per rebirth.
          Focus on high-XP activities like <a class="xref" onclick="navigateTo('crafting')">crafting Cake</a> and collecting <a class="xref" onclick="navigateTo('animals')">truffles</a> to speed-run back to Level 50!
          Check <a class="xref" onclick="navigateTo('tips')">Tips &amp; Strategies</a> for speed-running advice.</span>
        </div>
      </div>

      <!-- Rebirth Blessings -->
      <div class="guide-section" id="blessings">
        <div class="guide-section-title">&#x2728; Rebirth Blessings</div>

        <p class="guide-text">
          After your first <a class="xref" onclick="navigateTo('rebirth')">Rebirth</a>, you unlock <strong>Rebirth Blessings</strong> &mdash;
          a permanent meta-progression system. Spend <strong>Rebirth Shards</strong> (earned 1 per rebirth) on powerful
          bonuses that persist forever across all future runs.
        </p>
        <p class="guide-text">
          Visit the <strong>Ritual Area</strong> on the second floor of your house to access the Rebirth Blessings tree.
        </p>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Haste Tree (15 shards max)</div>
          <p class="guide-text">Reduce timers on crops, animals, and contracts.</p>
          <table class="guide-table">
            <tr><th>Blessing</th><th>Max</th><th>Effect</th></tr>
            <tr><td>Fleet Harvest</td><td>3</td><td>-3% crop grow time per rank</td></tr>
            <tr><td>Swift Husbandry</td><td>3</td><td>-3% animal cooldown per rank</td></tr>
            <tr><td>Quick Contracts</td><td>3</td><td>-30% contract refresh time &amp; +0.5x reward multiplier per rank</td></tr>
            <tr><td>Rushing Winds</td><td>2</td><td>-4% crop &amp; animal time per rank (requires Fleet Harvest 2)</td></tr>
            <tr><td>Nimble Hands</td><td>2</td><td>-4% crop &amp; animal time per rank (requires Swift Husbandry 2)</td></tr>
            <tr><td>Time Warp</td><td>2</td><td>-5% ALL timers per rank (requires Rushing Winds 2 + Nimble Hands 2)</td></tr>
          </table>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Abundance Tree (15 shards max)</div>
          <p class="guide-text">Boost XP, gold, and yields.</p>
          <table class="guide-table">
            <tr><th>Blessing</th><th>Max</th><th>Effect</th></tr>
            <tr><td>Windfall</td><td>3</td><td>+25 gold per level-up per rank</td></tr>
            <tr><td>Green Fingers</td><td>3</td><td>+2 planting &amp; harvest XP per rank</td></tr>
            <tr><td>Stockpiler</td><td>3</td><td>+2 animal start &amp; collect XP per rank</td></tr>
            <tr><td>Artisan Touch</td><td>3</td><td>+3 crafting XP per rank (requires Green Fingers 2)</td></tr>
            <tr><td>Fortune</td><td>2</td><td>+50 gold per level-up per rank (requires Windfall 2)</td></tr>
            <tr><td>Cornucopia</td><td>1</td><td>+1 bonus crop &amp; animal product (requires Fortune 2 + one of Green Fingers 2 or Stockpiler 2)</td></tr>
          </table>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Legacy Tree (15 shards max)</div>
          <p class="guide-text">Start each run with bonus resources. Legacy bonuses scale with Rebirth Count!</p>
          <table class="guide-table">
            <tr><th>Blessing</th><th>Max</th><th>Effect</th></tr>
            <tr><td>Nest Egg</td><td>3</td><td>Start with rank &times; 100 &times; Rebirth Count gold</td></tr>
            <tr><td>Seed Vault</td><td>3</td><td>Start with rank &times; 10 &times; Rebirth Count wheat seeds</td></tr>
            <tr><td>Seasoned</td><td>3</td><td>Start with rank &times; Rebirth Count talent points</td></tr>
            <tr><td>Tool Shed</td><td>4</td><td>Start with all tools at tier = rank (requires Nest Egg 2)</td></tr>
            <tr><td>Recipe Tome</td><td>1</td><td>Start with all 11 recipes unlocked (requires Seed Vault 2)</td></tr>
            <tr><td>Quick Start</td><td>1</td><td>Start at Level 3 with 3 talent points (requires Seasoned 2)</td></tr>
          </table>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Respec</div>
          <p class="guide-text">
            You can respec all Rebirth Blessings for <strong>free</strong> at any time.
            All invested shards will be refunded.
          </p>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Mystic Essence</div>
          <p class="guide-text">
            Each rebirth also grants <strong>Rebirth Count &times; 10 Mystic Essence</strong>, a cosmetic currency for future use.
          </p>
        </div>

        <div class="guide-tip">
          <span class="guide-tip-icon">&#x1F4A1;</span>
          <span class="guide-tip-text"><strong>Pro Tip:</strong> Legacy blessings scale with your Rebirth Count, making each subsequent run significantly faster.
          At Rebirth 10 with Nest Egg rank 3, you start with 3,000 gold!</span>
        </div>
      </div>

      <!-- Controls Reference -->
      <div class="guide-section" id="controls">
        <div class="guide-section-title">&#x1F3AE; Controls Reference</div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Menu Controls</div>
          <table class="guide-table">
            <tr><th>Key</th><th>Action</th></tr>
            <tr><td><span class="guide-key">E</span></td><td>Open/Close the inventory menu</td></tr>
            <tr><td><span class="guide-key">Y</span></td><td>Open/Close the <a class="xref" onclick="navigateTo('talents')">talent tree</a></td></tr>
            <tr><td><span class="guide-key">L</span></td><td>Open/Close the <a class="xref" onclick="navigateTo('rebirth')">rebirth leaderboard</a></td></tr>
            <tr><td><span class="guide-key">V</span></td><td>Open/Close the <a class="xref" onclick="navigateTo('gold-store')">gold store</a></td></tr>
            <tr><td><span class="guide-key">G</span></td><td>Open/Close this game guide</td></tr>
            <tr><td><span class="guide-key">ESC</span></td><td>Close current menu/guide</td></tr>
          </table>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">3D World Controls</div>
          <table class="guide-table">
            <tr><th>Key</th><th>Action</th></tr>
            <tr><td><span class="guide-key">W A S D</span></td><td>Move around the farm</td></tr>
            <tr><td><span class="guide-key">Space</span></td><td>Jump</td></tr>
            <tr><td><span class="guide-key">Walk Through</span></td><td>Collect <a class="xref" onclick="navigateTo('crops')">crops</a>, <a class="xref" onclick="navigateTo('animals')">products</a>, and interact with stations</td></tr>
            <tr><td><span class="guide-key">Mouse</span></td><td>Look around</td></tr>
          </table>
        </div>
      </div>

      <!-- FAQ Section -->
      <div class="guide-section" id="faq">
        <div class="guide-section-title">&#x2753; Frequently Asked Questions</div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Q: Why can't I start an animal?</div>
          <p class="guide-text">You need to buy the correct <strong><a class="xref" onclick="navigateTo('equipment')">equipment</a></strong> from the
          <a class="xref" onclick="navigateTo('marketplace')">Blueprint Store</a> first.
          Each animal type requires specific equipment (e.g., Milk Pail for cows, Bee Suit for beehives).
          See the <a class="xref" onclick="navigateTo('animals')">Animals</a> page for the full reference table.</p>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Q: Why can't I plant a certain crop?</div>
          <p class="guide-text">Check two things: 1) Do you have seeds? Buy them from the <a class="xref" onclick="navigateTo('marketplace')">Seed Store</a>.
          2) Is the crop unlocked? Some crops require higher <a class="xref" onclick="navigateTo('leveling')">levels</a>.
          See the <a class="xref" onclick="navigateTo('crops')">Growing Crops</a> page for unlock levels.</p>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Q: Why can't I craft an item?</div>
          <p class="guide-text">You need to <strong>buy the recipe first</strong> from the <a class="xref" onclick="navigateTo('marketplace')">Blueprint Store</a>.
          Also make sure you have all the required ingredients - some recipes need other crafted items!
          See the <a class="xref" onclick="navigateTo('crafting')">Crafting</a> page for the full recipe table.</p>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Q: How do I collect animal products?</div>
          <p class="guide-text">Walk to the <strong>collection station</strong> for that animal type (e.g., Honey Jar for beehives,
          Milk Pail station for cows). All ready products will be collected at once!
          See <a class="xref" onclick="navigateTo('animals')">Raising Animals</a> for station names.</p>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Q: What is Rebirth?</div>
          <p class="guide-text">When you reach <strong>Level 50</strong>, you can <a class="xref" onclick="navigateTo('rebirth')">Rebirth</a> to reset all progress and start fresh.
          Your rebirth count is tracked on a global leaderboard. Press <span class="guide-key">L</span> to view the leaderboard and rebirth.</p>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Q: What are Contracts?</div>
          <p class="guide-text">
            <a class="xref" onclick="navigateTo('contracts')">Contracts</a> are delivery orders you can fulfill for bonus gold and XP (2-4x profit!).
            Visit the Contracts stall in the <a class="xref" onclick="navigateTo('marketplace')">marketplace</a> to see your contract board.
            Each slot shows a contract offer that refreshes every 2 minutes. Accept the ones you like, skip the ones you don't.
            Unlock more slots with <a class="xref" onclick="navigateTo('talents')">Contractor talents</a>.
          </p>
        </div>

        <div class="guide-subsection">
          <div class="guide-subsection-title">Q: My crops/animals show "Ready" but nothing happens?</div>
          <p class="guide-text">You need to physically walk through the item in the 3D world to collect it.
          The menu shows status but you collect in the 3D world!
          See <a class="xref" onclick="navigateTo('controls')">Controls</a> for all keybindings.</p>
        </div>
      </div>

      </div><!-- end page-content -->

      <!-- Prev / Next Navigation -->
      <div class="page-nav" id="pageNav"></div>
    </div>
  </div><!-- end guide-body -->
  </div><!-- end guide-container -->

  <script src="https://portals-labs.github.io/portals-sdk/portals-sdk.js?v=10005456"></script>
  <script>
    // ============================================
    // HUGHBERRY FARMS - GAME GUIDE (GitBook-style)
    // ============================================

    // Ordered list of pages
    var PAGES = [
      { id: 'welcome',         label: 'Welcome',          icon: '\u{1F3E1}' },
      { id: 'getting-started',  label: 'Getting Started',   icon: '\u{1F331}' },
      { id: 'crops',           label: 'Growing Crops',     icon: '\u{1F33E}' },
      { id: 'animals',         label: 'Raising Animals',   icon: '\u{1F404}' },
      { id: 'equipment',       label: 'Equipment',         icon: '\u2692\uFE0F' },
      { id: 'crafting',        label: 'Crafting',          icon: '\u2692\uFE0F' },
      { id: 'marketplace',     label: 'Marketplace',       icon: '\u{1F3EA}' },
      { id: 'leveling',        label: 'XP & Leveling',     icon: '\u2B50' },
      { id: 'tips',            label: 'Tips & Strategies',  icon: '\u{1F4DD}' },
      { id: 'talents',         label: 'Talent System',     icon: '\u{1F33F}' },
      { id: 'contracts',       label: 'Contracts',         icon: '\u{1F4CB}' },
      { id: 'gold-store',      label: 'Gold Store',        icon: '\u{1FA99}' },
      { id: 'rebirth',         label: 'Rebirth',           icon: '\u{1F504}' },
      { id: 'blessings',       label: 'Blessings',         icon: '\u2728' },
      { id: 'controls',        label: 'Controls',          icon: '\u{1F3AE}' },
      { id: 'faq',             label: 'FAQ',               icon: '\u2753' }
    ];

    var currentPage = 'welcome';

    function navigateTo(pageId) {
      // Hide all sections
      var sections = document.querySelectorAll('.guide-section');
      for (var i = 0; i < sections.length; i++) {
        sections[i].classList.remove('active-page');
      }

      // Show target section
      var target = document.getElementById(pageId);
      if (target) {
        target.classList.add('active-page');
      }

      // Update sidebar active state
      var links = document.querySelectorAll('.sidebar-link');
      for (var j = 0; j < links.length; j++) {
        links[j].classList.remove('active');
        if (links[j].getAttribute('data-target') === pageId) {
          links[j].classList.add('active');
          // Scroll sidebar link into view
          links[j].scrollIntoView({ block: 'nearest', behavior: 'smooth' });
        }
      }

      // Update breadcrumb
      var pageInfo = null;
      var pageIndex = -1;
      for (var k = 0; k < PAGES.length; k++) {
        if (PAGES[k].id === pageId) {
          pageInfo = PAGES[k];
          pageIndex = k;
          break;
        }
      }
      if (pageInfo) {
        document.getElementById('breadcrumb-current').textContent = pageInfo.label;
      }

      // Update prev/next nav
      renderPageNav(pageIndex);

      // Scroll content to top
      var wrapper = document.getElementById('guideContent');
      if (wrapper) wrapper.scrollTop = 0;

      currentPage = pageId;
    }

    function renderPageNav(pageIndex) {
      var nav = document.getElementById('pageNav');
      if (!nav) return;

      var html = '';

      // Previous button
      if (pageIndex > 0) {
        var prev = PAGES[pageIndex - 1];
        html += '<a class="page-nav-btn prev" onclick="navigateTo(\'' + prev.id + '\')">';
        html += '<span class="page-nav-dir">\u2190 Previous</span>';
        html += '<span class="page-nav-label">' + prev.label + '</span>';
        html += '</a>';
      } else {
        html += '<div class="page-nav-spacer"></div>';
      }

      // Next button
      if (pageIndex < PAGES.length - 1) {
        var next = PAGES[pageIndex + 1];
        html += '<a class="page-nav-btn next" onclick="navigateTo(\'' + next.id + '\')">';
        html += '<span class="page-nav-dir">Next \u2192</span>';
        html += '<span class="page-nav-label">' + next.label + '</span>';
        html += '</a>';
      } else {
        html += '<div class="page-nav-spacer"></div>';
      }

      nav.innerHTML = html;
    }

    // === Sound Effects ===
    var _clickSound = new Audio('click.mp3'); _clickSound.preload = 'auto'; _clickSound.volume = 0.6;
    function playSound() { try { _clickSound.currentTime = 0; _clickSound.play().catch(function(){}); } catch(e){} }

    // Close function - use SDK closeIframe
    function triggerTask(taskName) {
      if (typeof PortalsSdk !== 'undefined' && PortalsSdk.sendMessageToUnity) {
        PortalsSdk.sendMessageToUnity(JSON.stringify({ TaskName: taskName, TaskTargetState: 'SetNotActiveToActive' }));
      }
    }

    function closeGuide() {
      playSound();
      console.log('[Guide] Close guide requested');
      triggerTask('HUD');
      if (typeof PortalsSdk !== 'undefined' && PortalsSdk.closeIframe) {
        PortalsSdk.closeIframe();
      }
    }

    // Keyboard controls - ESC to close
    document.addEventListener('keydown', function(e) {
      var key = e.key.toLowerCase();
      if (e.key === 'Escape' || key === 'l' || key === 'e' || key === 'y' || key === 'g' || key === 'v') {
        e.preventDefault();
        closeGuide();
      }
    });

    // XP sound
    var _xpSound = new Audio('xp-gain.mp3'); _xpSound.preload = 'auto'; _xpSound.volume = 0.3;
    var _guidePrevXP = -1, _guidePrevLevel = -1, _guideFirstXP = true;

    // Setup SDK listener
    function setupMessageListener() {
      if (typeof PortalsSdk !== 'undefined' && PortalsSdk.setMessageListener) {
        PortalsSdk.setMessageListener(function(msg) {
          if(!_uiPopPlayed){_uiPopPlayed=true;try{if(_uiPopCtx&&_uiPopBuf){if(_uiPopCtx.state==='suspended')_uiPopCtx.resume();var _s=_uiPopCtx.createBufferSource();var _g=_uiPopCtx.createGain();_s.buffer=_uiPopBuf;_g.gain.value=0.5;_s.connect(_g);_g.connect(_uiPopCtx.destination);_s.start(0)}}catch(e){}}
          // XP sound tracking
          if (typeof msg === 'string' && msg.indexOf('Sync_Inventory') === 0) {
            var _parts = msg.split('_'); var _xp = -1, _lv = -1;
            for (var _i = 0; _i < _parts.length - 1; _i++) {
              if (_parts[_i] === 'XP') { var v = parseInt(_parts[_i+1]); _xp = isNaN(v) ? 0 : v; }
              if (_parts[_i] === 'Level') { var v2 = parseInt(_parts[_i+1]); _lv = isNaN(v2) ? 0 : v2; }
            }
            if (_xp >= 0 && _lv >= 0) {
              if (_guideFirstXP) { _guideFirstXP = false; _guidePrevXP = _xp; _guidePrevLevel = _lv; }
              else { if (_lv === _guidePrevLevel && _xp > _guidePrevXP) { setTimeout(function() { try { _xpSound.currentTime = 0; _xpSound.play().catch(function(){}); } catch(e) {} }, 500); } _guidePrevXP = _xp; _guidePrevLevel = _lv; }
            }
          }
          console.log('[Guide] Received message:', msg);
        });
        console.log('[Guide] SDK listener registered');
      } else {
        setTimeout(setupMessageListener, 100);
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      console.log('[Guide] Game Guide loaded');
      setupMessageListener();
      // Initialize first page nav
      renderPageNav(0);
    });
  </script>
</body>
</html>
